---
title: GeneralFunctionsOfThePlatform
description: 
published: true
date: 2024-01-25T14:31:14.469Z
tags: 
editor: markdown
dateCreated: 2024-01-25T07:43:31.012Z
---

# Таблицы
Через переменные в виде строки json можно передавать произвольные таблицы и размещать их в разных местах программы. Под таблицей подразумевается табличная форма - колонки и строки. Также через элемент «Таблица» можно определить список, аналогичный списку карточек- подробнее в «Список карточек»

Произвольная таблица может быть представлена в виде:

- **Элемента экрана**, вместе с другими элементами. Для этого нужно использовать элемент экрана «Таблица» и в переменной передать строку json в специальном формате
- Переопределить нажатие центральной кнопки **План-факт**. Старый формат также действует, но если задана произвольная таблица то это имеет приоритет. Для этого нужно вставить переменную **central_table**. `hashMap.put("central_table", CтpoкaJSON)`
- Вызвать отдельное окно с таблицей по какому то событию (например по нажатию кнопки) с заполненной таблицей на весь экран. Для этого нужно использовать переменную **report_table**
- `hashMap.put("report_table",CтpoкaJSON)`

В структуре json можно описывать :

> - Столбцы таблицы – имя, заголовок, ширину колонки
> - Общие опции таблицы – размер шрифта, скрыть заголовок, отключить подсветку линий через строку
> - Непосредственно данные в ячейках
> - Раскраску отдельных ячеек произвольными цветами

Структура формата таблицы не зависит от места использования таблицы – она общая.
Пример формата:
```json
{
"type": "table",
"textsize": "25",
"hidecaption": "true",
"hideinterline": "true",
"columns": [
  {
    "name": "nom",
    "header": "Товар",
    "weight": "2"
  },
  {
    "name": "qty",
    "header": "Кол-во",
    "weight": "1"
  },
  {
    "name": "price",
    "header": "Цена",
    "weight": "1"
  }
],
"rows": [
  {
    "name": "Процессов Intel Core 9 OEM",
    "qty": "5",
    "price": "15500.00"
  },
  {
    "name": "Процессов Intel Core 5 BOX",
    "qty": "-2",
    "price": "12500.00"
  },
  {
    "name": "Процессов Intel Core 5 (OEM)",
    "qty": "2",
    "price": "11500.00"
  }
],
"colorcells": [
  {
    "row": "1",
    "column": "1",
    "color": "#d81b60"
  }
]
}
```

Атрибут type обязательный он должен быть всегда значение «table»
> ### Атрибуты таблиц
>- **textsize** -необязательный – отвечает за размер текста
>- **hidecaption** – необязательный – не выводить шапку таблицы
>- **hideinterline** – необязательный – не выводить раскраску строк
>- **borders** – необязательный – выводит границы ячеек таблицы
>- **columns** _обязательный_ массив в котором описываются колонки. 
>**name** – внутреннее имя 
>**header** -отображаемый заголовок 
>**weight** – ширина колонки в виде относительного веса 
>**gravity** - выравнивание текста (left,right,center). Если задать все колонки в 1 то они будут равны.
>- **rows** _обязательный_ массив в котором описываются строки. Каждый элемент имеет имя, совпадающее с именем столбца и значение
>- **colorcells** _необязательный*_ массив– подсветка произвольных ячеек нужным цветом. Строка и столбец задаются номерами начиная с 0. Цвет (color) – в HEX виде.

Нажатие на строку таблицы таблицы вызывает _событие ввода_ и передачи данных на сервер. Выбранная строка - объект JSON сериализуется в переменную **selected_line**

Для «самостоятельно режима» при клике по таблице возвращается не json. Программа ищет в выделенной строке поля **id**, **order** и **orderRef** и если они есть, записывает в переменные значения `selected_line_id`, `order` и `orderRef`

# Адаптер таблицы
При работе через закладку Offline&REST в самостоятельном режиме источником данных могут служить либо запрос к SQL либо GET-запрос. Для того чтобы оформить колонки таблицы в строке запроса указывается _адаптер_ - справочник в котором прописываются видимые заголовки колонок, ширина колонок и ключ(значение которое будет возвращаться по клику)

# Списки карточек
## Кастомные списки
Можно определить любую разметку для элемента списка на основе структуры контейнера. Для этого используется либо элемент «Список карточек» с структурой списка
```json
{"customcards": 
	{
	"layout": {..контейнер..},
	"cardsdata": [{данные},{},{}]
	} 
}
```
Для отображения в виде «карточек», либо элемент «Таблица» с переменной типа
```json
{"customcards": 
	{
	"layout": {..контейнер..},
	"tabledata": [{данные},{},{}]
	} 
}
```
Для отображения в виде сплошного списка без выделения карточек.
Контейнер можно разработать в «редакторе» и перенести через буфер обмена в код переменной

Данные в обоих случаях – массив JSON -объектов по одному на каждый элемент списка. В которых перечисляются переменные, отображаемые в контейнере. Также могут быть добавлены любые другие.

Также отдельно нужно выделить key – ключ, возвращаемый при нажатии

Пример определения такой переменной в python:
```python
form_custom = { "customcards":         {
        "options":{
          "search_enabled":True,
          "save_position":True
        },

        "layout": {
        "type": "LinearLayout",
        "orientation": "vertical",
        "height": "match_parent",
        "width": "match_parent",
        "weight": "0",
        "Elements": [
        {
            "type": "LinearLayout",
            "orientation": "horizontal",
            "height": "wrap_content",
            "width": "match_parent",
            "weight": "0",
            "Elements": [
            {
            "type": "Picture",
            "show_by_condition": "",
            "Value": "@pic1",
            "NoRefresh": False,
            "document_type": "",
            "mask": "",
            "Variable": "",
            "TextSize": "16",
            "TextColor": "#DB7093",
            "TextBold": True,
            "TextItalic": False,
            "BackgroundColor": "",
            "width": "match_parent",
            "height": "wrap_content",
            "weight": 2
            },
            {
            "type": "LinearLayout",
            "orientation": "vertical",
            "height": "wrap_content",
            "width": "match_parent",
            "weight": "1",
            "Elements": [
            {
                "type": "TextView",
                "show_by_condition": "",
                "Value": "@string1",
                "NoRefresh": False,
                "document_type": "",
                "mask": "",
                "Variable": ""
            },
            {
                "type": "TextView",
                "show_by_condition": "",
                "Value": "@string2",
                "NoRefresh": False,
                "document_type": "",
                "mask": "",
                "Variable": ""
            },
            {
                "type": "TextView",
                "show_by_condition": "",
                "Value": "@string3",
                "NoRefresh": False,
                "document_type": "",
                "mask": "",
                "Variable": ""
            }
            ]
            },
            {
            "type": "TextView",
            "show_by_condition": "",
            "Value": "@val",
            "NoRefresh": False,
            "document_type": "",
            "mask": "",
            "Variable": "",
            "TextSize": "16",
            "TextColor": "#DB7093",
            "TextBold": True,
            "TextItalic": False,
            "BackgroundColor": "",
            "width": "match_parent",
            "height": "wrap_content",
            "weight": 2
            }
            ]
        },
        {
            "type": "TextView",
            "show_by_condition": "",
            "Value": "@descr",
            "NoRefresh": False,
            "document_type": "",
            "mask": "",
            "Variable": "",
            "TextSize": "-1",
            "TextColor": "#6F9393",
            "TextBold": False,
            "TextItalic": True,
            "BackgroundColor": "",
            "width": "wrap_content",
            "height": "wrap_content",
            "weight": 0
        }
        ]
    }

}
}

form_custom["customcards"]["cardsdata"]=[]
for element in range(0,2):
    filling = {
    "key": str(element),
    "descr": "Pos. " + str(element),
	"string1": "Котята",  
	"string2": "2 штуки",  
	"string3": "сидят"
  }
    form_custom["customcards"]["cardsdata"].append(filling)

hashMap.put("cards",json.dumps(form_custom,ensure_ascii=False).encode('utf8').decode())
```
![Pastedimage20240115172510.png](/files/Pastedimage20240115172510.png)

## Использование активных элементов в кастомных списках
Доступно использование активных элементов: Кнопки, Меню и Флажки. Для этого их нужно разместить в контейнере в любом количестве и любом месте. При нажатии они будут порождать отдельное от нажатия на саму карточку событие с `listener = LayoutAction`, также помещается переменные layout_listener и card_data. В первой содержится переменная элемента, породившего событие (кнопки, пункта меню, флажка). Во второй - данные карточки, включая позицию в виде JSON-строки. Для добавления меню нужно поместить в контейнер элемент PopupMenuButton, в качестве значения передать список пунктов меню, разделенных точкой с запятой. Например «Первый;Второй» Флажок ведет себя как обычный флажок, плюс выполняет необходимое действие - при изменении состояния, он прописывает значение состояния в датасет переменной списка, чтобы при обновлении списка показать текущее состояние.

## Использование поиска, переопределение поиска
Для того, чтобы на экране появился автоматический поиск по таблице в тулбаре, необходимо добавить в JSON списка в раздел «options» поле «search_enabled» с значением True. Также по желанию, можно передать поле, по которому будет вестись поиск «search_string» - это строка, в которую для каждой карточки можно поместить строку с данными поиска. Поиск ведется по вхождению подстроки поиска в эту строку. Если такого поля нет в карточке, то будет вестись поиск по всем полям объекта данных. Этот поиск можно переопределить - пустить вводимый текст на события. Для этого в раздел «options» необходимо добавить «override_search» с значением True, тогда при вводе текста в поле поиска будет генерироваться событие «Search», а в переменную «SearchString» введенный текст
```json
{"customcards": {  
    "options": {  
        "search_enabled": True,  
        "save_position": True  
	 }
   ............
   }
}
```
![Pastedimage20240115174217.png](/files/Pastedimage20240115174217.png)

## Сохранение позиции в списке
Для того, чтобы на экране появился автоматический поиск по таблице в тулбаре, необходимо добавить в JSON списка в раздел «options» поле «save_position» с значением True. При наступлении события и перерисовке списка, список останется на том же месте.
```json
{"customcards": {  
    "options": {  
        "search_enabled": True,  
        "save_position": True  
	 }
   ............
   }
}
```

## Использование групп
Можно сгруппировать список карточек (работает только со списком карточек). Для этого в нужных местах датасета нужно вставить объекты с полем «group» (предопределенное поле)

## Предопределенные списки
Карточки могут содержать 1 картинку либо, если ее нет то ее место сдвигается и остаются поля. Полей может быть сколько угодно. Они состоят из пар «Заголовок»-«Значение», но заголовка опять же может не быть. При этом можно менять размер и цвет текста, а в самих полях писать HTML-текст.
Списки карточек могут работать в онлайн режиме, оффлайн режиме и режиме связи с бекендом.
В онлайн режиме источник данных и правила оформления задаются в виде JSON-строки на сервере. Например это может быть так:
```json
{
  "cards": [
  {
    "key": "key_00320055",
    "picture": "",
    "description": "какой то комментарий",
    "items": [
      {
        "key": "",
        "value": "Материнская плата GIGABYTE B450M DS3H",
        "size": "15",
        "color": "#1b31c2",
        "caption_size": "12",
        "caption_color": "#1b31c2"
      },
      {
        "key": "Цена",
        "value": 5500,
        "size": "25",
        "color": "#131e61"
      }
    ]
  },
  {
    "key": "key_00320023",
    "items": [
      {
        "key": "",
        "value": "Процессор intel i7",
        "size": "15",
        "color": "#1b31c2",
        "caption_size": "12",
        "caption_color": "#1b31c2"
      },
      {
        "key": "Цена",
        "value": 17500,
        "size": "25",
        "color": "#131e61",
        "caption_size": "12",
        "caption_color": "#1b31c2"
      },
      {
        "key": "Скидка",
        "value": 1500,
        "size": "25",
        "color": "#DC143C",
        "caption_size": "15",
        "caption_color": "#DC143C"
      }
    ]
  }
]
}
```
В каждой карточке присутствует ключевое поле. В JSON это- «key». По нему в дальнейшем идет обработка клика по карточке.

Клик по карточке порождает событие «CardsClick» и добавляет в структуру переменных переменные «selected_card_key» и «selected_card_position» содержащие ключ и позицию карточки.






[[Tables]]
[[TableAdapter]]
[[CardLists]]
[[PredefinedLists]]
[[TilesAndTiledMainMenu]]
[[Basket]]
[[ImagesFromTheCache]]
[[RunningProcessesFromProcesses]]
[[ModalScreens]]
[[LoginMethods]]


[[DocumentationRighScan]]
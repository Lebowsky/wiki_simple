---
title: WorkingWithBluetoothDevices
description: 
published: true
date: 2024-02-16T12:51:49.585Z
tags: 
editor: markdown
dateCreated: 2024-02-16T12:51:09.544Z
---

# Работа с Bluetooth устройствами
В общем случае, для различных категорий Bluetooth устройств схема работы состоит из:

1. Чтение подключенных устройств с целью выбора устройства. Необязательный шаг, если вам известен mac-адрес устройства. На данном шаге могут анализироваться как уже сопряженные устройства так и обнаружение новых
2. Отправка данных на порт устройства – в виде байт-массива.
3. Подписка на данные, получаемые из устройства

Команды для работы с Bluetooth доступны через импорт java-модуля SimpleBluetooth из python-обработчиков и частично через команды-переменные.
Методы и команды доступные из процессов для выбора устройств:
- **BTGetBounded** – команда-переменная для поиска сопряжённых устройств. Получает ответ в переменной **BTResult** в виде JSON-массива подключенных устройств.
- **BTStartScan** – команда-переменная для запуска сканирования новых устройств (помимо уже сопряжённых). По окончанию, возвращает результат в **BTDiscoverResult** в виде JSON-массива устройств. Также совместно с этой командой имеет смысл использовать команду **BTDiscoverHandlers** в качестве параметра к которой указывается стандартный массив обработчиков. Это событие будет сгенерировано по окончанию поиска устройств.

## Подключение к устройству в режиме аксессуара (пассивный режим устройства, например принтер)

Подключение к устройству (mac-выбранный из списка устройств mac-адрес устройства,handlers – строка с обработчиками в случае неудачи)

```python
from ru.travelfood.simple_ui import SimpleBluetooth as BT

bt = BT()
device = bt.get_device(mac) #получение устройства по mac-адресу
if device == None:
   hashMap.put("toast", "Не получилось подключиться")
else:
   if bt.connect_to_client(device,handlers): #подключение к устройству
              #действия с устройством
              bt.close_socket() #отключение от устройства
```

## Подключение к устройству в режиме хоста (активный режим, например сканер)

```python
from ru.travelfood.simple_ui import SimpleBluetooth as BT

bt = BT()
device = bt.get_device(mac)
      if device == None:
          hashMap.put("toast", "Не получилось подключиться")
      else:
          if bt.connect_to_server(device):
              #действия с устройством
```

## Отправка данных (методы модуля SimpleBluetooth)

**write_data("данные", "строка-массив обработчиков")**
Данные – данные в виде строки, целого числа или массива байтов.
Массив обработчиков – строка с обработчиками в случае неудачи

## Подписка на данные устройства, отключение подписки (методы модуля SimpleBluetooth)

**begin_listen_for_data("строка-массив обработчиков")** – подключает массив обработчиков на события устройства. Обработчики должны быть обязательно pythonbytes
**stop_listen()** – отключение подписки на события устройства



---
title: OneTimeTasks
description: 
published: true
date: 2024-02-16T12:55:47.909Z
tags: 
editor: markdown
dateCreated: 2024-02-16T08:24:45.911Z
---

## Однократные фоновые задания
Для запуска используется команда -переменная "**StartWork**",  в качестве параметра которой передается json с обработчиками, которые надо выполнить, и тегом задачи. Тег нужен для того, чтобы в случае чего по нему можно было обратиться и отменить выполнение:

```Python
hashMap.put(StartWork, {"work": "массив обработчиков",
						"tag": "тег задачи",
						"retry": "флаг повтора",
						"conditions": "список условий"})
```
- work - унифицированный массив обработчиков, `[{"action":"run","type":"python","method":"some_longtime_routine"}]`
- tag - нужен для того, чтобы в случае чего по нему можно было обратиться и отменить выполнение.
- retry - заставляет в случае неудачи выполнения (исключение в коде или ошибка http-запроса >200), переключаться в состояние RETRY, что ставит задачу снова в очередь выполнения. 
- conditions - устанавливает условия запуска задачи, их может быть одно или несколько сразу (разделитель – “;”). Условия следующие:
    - CONNECTED – наличие связи
    - CHARGING – устройство находится на зарядке
    - BATTERY_NOT_LOW – заряд батареи достаточен
    - IDLE – устройство не используется


Выполнение Python и выполнение некоторых команд зависит от контекста приложения, т.е. например, чтобы выполнить ShowScreen, нужно, чтобы было хотя бы в свернутом виде запущено приложение Simple и открыт какой то процесс в нем. Для speak нужен просто контекст приложения, чтобы был запущен TTS – менеджер. То есть, другими словами, некоторые команды не выполнятся, если приложение вообще не запущено или находится в сне. Но есть команды, которые будут выполнены даже если девайс перезапущен и в памяти не висит SimpleUI. Например, работа с СУБД через нативный обработчик – без проблем, HTTP-запросы – тоже без проблем. Например:
```Python
def run_request_task_native(hashMap,_files=None,_data=None):  
    hashMap.put("BreakHandlersIfError","")  
    
    workercode=[{"action":"run","type":"http","method":"GET #long1c/get_goods"},
			    {"action":"run","type":"set","method":"SQLParameter=@ResultMessage"},
			    {"action":"run","type":"sql","method":"insert into goods(art,barcode,nom) values(?,?,?)"},
			    {"action":"run","type":"set","method":"speak=Данные загружены"}]		    
          
    hashMap.put("StartWork",json.dumps({"work": workercode, "tag": "my_single_task", "retry": True, "conditions":"BATTERY_NOT_LOW;CHARGING;CONNECTED"}, ensure_ascii=False))  
		      
    return hashMap
```
Обработчик отработает и после перезагрузки устройства, но команда speak не отработает, т.к приложение отсутствует в процессах.
